<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cek Blob Walrus dari Public Key Soundness</title>
   <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { color: #333; }
    input { padding: 8px; width: 400px; }
    button { padding: 8px 12px; }
    .loading { color: orange; }
    .error { color: red; }
    .result { margin-top: 10px; padding: 10px; border: 1px solid #ddd; }
  </style>
</head>
<body>

  <h2>Cek Blob Walrus y Public Key Soundness</h2>
  <p>Paste <b>Public Key</b> dari <code>soundness-cli list-keys</code>:</p>
  <input type="text" id="publicKey" placeholder="Masukkan Public Key Base64">
  <button onclick="cekBlob()">Cek</button>

  <div id="status"></div>
  <div id="hasil" class="result"></div>

  <!-- BlakeJS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/blakejs@1.2.1/blake2b.min.js"></script>

  <script>
    async function cekBlob() {
      const statusEl = document.getElementById("status");
      const hasilEl = document.getElementById("hasil");
      hasilEl.innerHTML = "";
      statusEl.innerHTML = "";

      let publicKeyBase64 = document.getElementById("publicKey").value.trim();
      if (!publicKeyBase64) {
        statusEl.innerHTML = `<span class="error">Public key tidak boleh kosong!</span>`;
        return;
      }

      try {
        statusEl.innerHTML = `<span class="loading">Mengonversi Public Key menjadi alamat Sui...</span>`;

        // Decode Base64 public key
        let publicKeyBytes = Uint8Array.from(atob(publicKeyBase64), c => c.charCodeAt(0));

        // Hash BLAKE2b-256
        let hash = blake2b(publicKeyBytes, null, 32);

        // Convert ke hex address
        let addressHex = Array.from(hash).map(b => b.toString(16).padStart(2, '0')).join('');

        statusEl.innerHTML = `<span class="loading">Alamat Sui: ${addressHex} â€” Mengambil blob history...</span>`;

        // Panggil API
        const API_KEY = "39Ki3kPJFMJ9eukD5yrpWJkNWX7Qm1";
        let resp = await fetch(`https://walrus-api.onrender.com/api/blobs/${addressHex}?apikey=${API_KEY}`);
        
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        
        let data = await resp.json();

        statusEl.innerHTML = `<span style="color:green;">Selesai!</span>`;
        hasilEl.innerHTML = `<b>Blob ID Base64:</b> ${data.blobIdBase64 || '-'}<br>
                             <b>Waktu:</b> ${data.timestamp || '-'}`;

      } catch (err) {
        statusEl.innerHTML = `<span class="error">Error: ${err.message}</span>`;
      }
    }
  </script>

</body>
</html>
